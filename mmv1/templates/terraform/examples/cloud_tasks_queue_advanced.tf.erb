resource "google_cloud_tasks_queue" "<%= ctx[:primary_resource_id] %>" {
  name = "<%= ctx[:vars]["name"] %>"
  location = "us-central1"

  app_engine_routing_override {
    service = "worker"
    version = "1.0"
    instance = "test"
  }

  uri_override {
    path_override {
      path = "/users/1234"
    }
    query_override {
      query_params = "qparam1=123&qparam2=456"
    }
    uri_override_enforce_mode = "IF_NOT_EXISTS"

    scheme = "HTTPS"
    host   = "example.com"
    port   = 8080
  }

  rate_limits {
    max_concurrent_dispatches = 3
    max_dispatches_per_second = 2
  }

  retry_config {
    max_attempts = 5
    max_retry_duration = "4s"
    max_backoff = "3s"
    min_backoff = "2s"
    max_doublings = 1
  }

  stackdriver_logging_config {
    sampling_ratio = 0.9
  }
}
